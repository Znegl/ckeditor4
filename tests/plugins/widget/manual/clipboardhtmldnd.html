<div id="editor">
	<p>Drop zone</p>
	<p>[Start here</p>
	<div data-widget="customwidget">Widget</div>
	<p>Consectetur dolores voluptatibus illo ipsam eveniet?</p>
	<div data-widget="customnestedwidget">
		<p>Widget</p>
		<div class="ned">
			<div data-widget="customwidget">Nested widget</div>
		</div>
	</div>
	<p>end here].</p>
	<p>Some [[inline widget]], too!</p>
	<p>Drop zone</p>
</div>

<script>
	if ( CKEDITOR.env.ie ) {
		bender.ignore();
	}

	CKEDITOR.replace( 'editor', {
		extraAllowedContent: 'span',
		extraPlugins: 'customwidget',
		allowedContent: true,
		height: 500
	} );

	CKEDITOR.plugins.add( 'customwidget', {
		requires: 'widget',
		allowedContent: 'div(copied)',

		init: function ( editor )	{
			var counter = 0;

			editor.widgets.add( 'customwidget', {
				button: 'Add widget',
				template: '<div>Widget</div>',

				getClipboardHtml: getClipboardHtml
			} );

			editor.widgets.add( 'customnestedwidget', {
				button: 'Add nested widget',
				template: '<div><p>Widget</p><div class="ned"><div data-widget="customwidget">Nested widget</div></div></div>',
				getClipboardHtml: getClipboardHtml,

				editables: {
					ned: '.ned'
				}
			} );

			function getClipboardHtml() {
				counter++;

				return '<div data-widget="' + this.name + '">Widget copied ' + counter + ' times!</div>';
			}
		}
	} );
</script>
